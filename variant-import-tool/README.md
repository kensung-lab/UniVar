# Variant Import Tool

## Description
Aim to import different type of files to different destination e.g. DB/ [`JSON`][json] file 
Currently focus on importing to [`MongoDB`][mongo-db]

## Requirement
- [Python][python] 3.12+

## Installation
```bash
cd variant-import-tool
pip install -r requirements.txt
```

## How to Run

### Require Files

#### SNP
- [`SNP`][snp] [`VCF`][vcf] file
- [`PED`][ped] file

#### SV
- [`SV`][sv] [`JSON`][json] file
- [`PED`][ped] file

#### Complete pipeline 
- Any variant file with the proband naming

#### Exomiser
- [`Exomiser Variant TSV`][exomiser-variant-tsv] file
- [`PED`][ped] file

### Require Data for SNP or SV

#### Gene Database
- make sure the `gene` database, `genes` and `versions` collection exist in the [MongoDB][mongo-db]
  - these information able to generated by [gene-database][gene-database]

#### Pipeline Version
- make sure the `common` database, `pipelineversion` collection exist in the [MongoDB][mongo-db]

### Command
- python variant_import_tool.py <variant_file_path> <ped_file_path> <database_path> <variant_type>

#### Description of each parameters

## Parameters
| Parameter Name      | Optional | Description                                                                                                               | Use For Type      |
| ------------------- | -------- | ------------------------------------------------------------------------------------------------------------------------- | ----------------- |
| `variant_file_path` | False    | The path to your variant file, can be any type of [Variant Type](#variant-type) of file                                   | ALL               |
| `ped_file_path`     | False    | The path of ped file, doesn't require for the type of `complete` so can input `DUMMY` for it                              | Except `Complete` |
| `database_path`     | False    | The database URL, currently only accept [MongoDB][mongo-db], if is `MONGO_BASE_URL`, it use environment variable as value | ALL               |
| `variant_type`      | False    | The type of variants you want to import can refer to [Variant Type](#variant-type) section                                | ALL               |
| `result-folder`     | True     | The result folder that contain the converted data, haven't tested                                                         | ALL               |
| `pipeline-version`  | True     | The pipeline version that is running, for gather the version of [gene-database][gene-database]                            | `SNP`, `SV`       |
| `database-name`     | True     | The result database name of where to store if empty it will use the file name to gather the database name                 | ALL               |
| `proband-id`        | True     | The proband ID of this variant file, if empty will use the first column of the [`VCF`][vcf] file as proband               | `SNP`, `SV`       |
| `access-group`      | True     | The access group of the result set database, now should be depredated                                                     | `Complete`        |
| `process-num`       | True     | The number of thread to run this program, default `50`                                                                    | `SNP`, `SV`       |
| `source`            | True     | The caller of the [`SV`][sv] file, if not specify then will gather from the file name                                     | `SV`              |
| `complete-num`      | True     | The number of this program run to complete the pipeline, if not specify read from [MongoDB][mongo-db]                     | `Complete`        |
| `uat`               | True     | The parameter to specify if this run is for UAT or not, if yes, mask the sample name                                      | Except `Exomiser` |
| `exomiser-run`      | True     | The name of this run of exomiser, must be unique per joined sample                                                        | `Exomiser`        |

## Variant Type
| Variant Type Key | Variant Type | Import file type                               | Description                                                                                |
| ---------------- | ------------ | ---------------------------------------------- | ------------------------------------------------------------------------------------------ |
| `snp_vcf`        | [`SNP`][snp] | [`VCF`][vcf]                                   | To import [`SNP`][snp] with [`VCF`][vcf] file format to different destinations             |
| `sv_json`        | [`SV`][sv]   | [`JSON`][json]                                 | To import [`SV`][sv] with [`JSON`][json] file format to different destinations             |
| `complete`       | NA           | Any Variant File                               | Using [MongoDB][mongo-db] data to calculate the compound het and show the database to user |
| `exomiser`       | NA           | [`Exomiser Variant TSV`][exomiser-variant-tsv] | To import [`Exomiser Variant TSV`][exomiser-variant-tsv] to different destinations         |

## Environment Variables

| Key                          | Description                                                                     | example                                     |
| ---------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------- |
| MONGO_BASE_URL               | Optional environment variable that not pass with parameter                      | mongodb://{uername:password@host:port/}     |
| SMTP_HOST                    | host of the smtp server, for sending complete email to user                     | email-smtp.ap-southeast-1.amazonaws.com     |
| SMTP_PORT                    | port of the smtp server, for sending complete email to user                     | 465                                         |
| SMTP_USER                    | username of the smtp server, for sending complete email to user                 | {smtp username}                             |
| SMTP_PASS                    | password of the smtp server, for sending complete email to user                 | {smtp password}                             |
| BACKEND_BASE_URL             | [UniVar Backend][univar-backend] url to trigger exomiser run                    | https://{BACKEND_BASE_URL}                  |
| BACKEND_SECRET               | secure the connection between this service and [UniVar Backend][univar-backend] | {secure string}                             |

## Dockerfile
The [Dockerfile][dockerfile] is for installing the dependency of [Python][python] library.

## Pending Tasks

### Dynamic import
Allow to use a [`JSON`][json] file to define what field to import to [MongoDB][mongo-db]

### Dynamic fields
Allow user to config the new added annotation using [`JSON`][json] format as parameter.


[comment]: <Below is the information for other markdown to reference>

[Bioinformation Related]: <========================================================>
[snp]: <https://www.genome.gov/genetics-glossary/Single-Nucleotide-Polymorphisms> (Single Nucleotide Polymorphisms)
[sv]: <https://www.ncbi.nlm.nih.gov/dbvar/content/overview/> (Structural Variation)
[str]: <https://en.wikipedia.org/wiki/STR_analysis> (Short tandem repeat)
[mitro]: <https://www.genome.gov/genetics-glossary/Mitochondrial-DNA> (â€‹MITOCHONDRIAL DNA)
[cram]: <https://en.wikipedia.org/wiki/CRAM_(file_format)> (Compressed Reference-oriented Alignment Map)
[vcf]: <https://samtools.github.io/hts-specs/VCFv4.4.pdf> (Variant Call Format)
[ped]: <https://gatk.broadinstitute.org/hc/en-us/articles/360035531972-PED-Pedigree-format> (Pedigree format)
[hpo-website]: <https://hpo.jax.org/> (HPO Website)
[gene]: <https://www.genome.gov/genetics-glossary/Gene> (Gene)
[exomiser]: <https://github.com/exomiser/Exomiser> (Exomiser)
[gene-panel]: <https://www.genomicseducation.hee.nhs.uk/genotes/knowledge-hub/gene-panel-sequencing/> (Gene Panel)
[allele-frequency]: <https://en.wikipedia.org/wiki/Allele_frequency> (Allele frequency)
[exomiser-variant-tsv]: <https://exomiser.readthedocs.io/en/latest/advanced_analysis.html#outputformats-1> (Exomiser Variant TSV)
[dna-sequencing]: <https://www.genome.gov/genetics-glossary/DNA-Sequencing> (DNA Sequencing)
[short-read-sequencing]: <https://www.genomicseducation.hee.nhs.uk/genotes/knowledge-hub/short-read-sequencing/> (Short Read Sequencing)
[fast5]: <https://help.nanoporetech.com/en/articles/6629603-what-is-a-fast5-file> (fast5)
[fastq]: <https://en.wikipedia.org/wiki/FASTQ_format> (fastq)
[igv]: <https://www.igv.org/> (Integrative Genomics Viewer)

[IT Related]: <====================================================================>
[ci-cd]: <https://www.redhat.com/en/topics/devops/what-is-ci-cd> (CI/CD)
[ci]: <https://www.ibm.com/topics/continuous-integration> (Continuous Integration)
[cd]: <https://www.ibm.com/topics/continuous-deployment> (Continuous Deployment)
[tls]: <https://www.cloudflare.com/zh-tw/learning/ssl/transport-layer-security-tls/> (TLS)
[https]: <https://www.cloudflare.com/learning/ssl/what-is-https/> (HTTPS)
[smtp]: <https://www.cloudflare.com/zh-tw/learning/email-security/what-is-smtp/> (SMTP)
[hostname]: <https://en.wikipedia.org/wiki/Hostname> (Hostname)
[port]: <https://en.wikipedia.org/wiki/Port_(computer_networking)> (Port)
[csv]: <https://en.wikipedia.org/wiki/Comma-separated_values> (Comma-separated values)
[restful-api]: <https://aws.amazon.com/tw/what-is/restful-api/> (RESTful API)
[ldap]: <https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol> (Lightweight Directory Access Protocol)

[Markdown Related]: <====================================================================>
[link-reference]: <https://www.eddymens.com/blog/how-to-reuse-links-in-markdown-reference-links> (Markdown Link Reference)

[Kubernetes Related]: <====================================================================>
[kubernetes]: <https://kubernetes.io/> (Kubernetes)
[kustomize]: <https://kustomize.io/> (Kustomize)
[k8s-namespace]: <https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/> (Kubernetes Namespace)
[k8s-secret]: <https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/> (Kubernetes Secret)
[k8s-dashboard]: <https://github.com/kubernetes/dashboard> (Kubernetes Dashboard)
[k8s-sa]: <https://kubernetes.io/docs/concepts/security/service-accounts/> (Kubernetes Service Accounts)
[k8s-configuration]: <https://kubernetes.io/docs/concepts/configuration/overview/> (Kubernetes Configuration)
[k8s-service]: <https://kubernetes.io/docs/reference/kubernetes-api/service-resources/service-v1/> (Kubernetes Service)
[kubectl]: <https://kubernetes.io/docs/reference/kubectl/> (kubectl)
[karpenter]: <https://karpenter.sh/> (Karpenter)
[helm]: <https://helm.sh/> (Helm)
[kong-ingress]: <https://docs.konghq.com/kubernetes-ingress-controller/latest/> (Kong Ingress Controller)
[ingress-controllers]: <https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/> (Ingress Controllers)
[k8-tz]: <https://github.com/k8tz/k8tz> (Kubernetes Timezone Controller)
[k8s-node]: <https://kubernetes.io/docs/concepts/architecture/nodes/> (Kubernetes Nodes)
[k8s-pod]: <https://kubernetes.io/docs/concepts/workloads/pods/> (Kubernetes Pods)

[Javascript Related]: <====================================================================>
[node-js]: <https://nodejs.org/en> (Node.js)
[type-script]: <https://www.typescriptlang.org/> (TypeScript)
[p-npm]: <https://pnpm.io/> (pNpm)
[nest-js]: <https://docs.nestjs.com/> (NestJS)
[vue]: <https://vuejs.org/> (Vue)
[vite-configure]: <https://vitejs.dev/config/> (Vite Configuration Guide)
[vitest]: <https://vitest.dev/> (Vitest)
[es-lint]: <https://eslint.org/> (ESLint)
[axios]: <https://github.com/axios/axios> (Axios)
[axios-response-interceptors]: <https://axios-http.com/docs/interceptors> (Response Interceptors)

[Docker Related]: <====================================================================>
[docker-image]: <https://docs.docker.com/get-started/overview/#images> (Docker image)
[docker-registry]: <https://docs.docker.com/registry/> (Docker Registry)
[container-image-digest]: <https://docs.digitalocean.com/glossary/digest/> (Container Image Digest)
[dockerfile]: <https://docs.docker.com/engine/reference/builder/> (Dockerfile)

[Git & Github Related]: <====================================================================>
[git]: <https://git-scm.com/> (git)
[github]: <https://github.com/> (Github)
[github-repositories]: <https://docs.github.com/en/repositories/creating-and-managing-repositories/about-repositories> (Github Repositories)
[git-submodule]: <https://git-scm.com/book/en/v2/Git-Tools-Submodules> (Git Submodule)
[github-docker-registry]: <https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-docker-registry> (Github Docker Registry)
[github-webhook]: <https://docs.github.com/en/webhooks/about-webhooks> (Github Webhook)

[IDE Related]: <====================================================================>
[ide]: <https://en.wikipedia.org/wiki/Integrated_development_environment> (Integrated Development Environment)
[vs-code]: <https://code.visualstudio.com/> (Visual Studio Code)
[vue-vs-plugin]: <https://marketplace.visualstudio.com/items?itemName=Vue.volar> (Vue Official VS Code Plugin)

[Programming Related]: <====================================================================>
[python]: <https://www.python.org/> (Python)

[Data Format Related]: <====================================================================>
[yaml]: <https://en.wikipedia.org/wiki/YAML> (YAML)
[json]: <https://en.wikipedia.org/wiki/JSON> (JSON)

[AWS Related]: <===================================================================>
[aws]: <https://aws.amazon.com/> (Amazon Web Services)
[aws-efs]: <https://aws.amazon.com/efs/> (Amazon Elastic File System)
[aws-eks]: <https://aws.amazon.com/eks/> (Amazon Elastic Kubernetes Service)
[aws-eventbridge]: <https://aws.amazon.com/eventbridge/> (Amazon EventBridge)
[aws-sqs]: <https://aws.amazon.com/sqs/> (Amazon Simple Queue Service)
[aws-sqs-fifo]: <https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-fifo-queues.html> (Amazon SQS FIFO queues)
[aws-s3]: <https://aws.amazon.com/s3/> (Amazon S3)
[aws-ses]: <https://aws.amazon.com/ses/> (Amazon Simple Email Service)
[aws-cloudwatch]: <https://aws.amazon.com/cloudwatch/> (Amazon CloudWatch)
[aws-ec2-spot]: <https://aws.amazon.com/ec2/spot/> (Amazon EC2 Spot Instances)
[aws-fargate]: <https://aws.amazon.com/fargate/> (AWS Fargate)
[aws-ebs]: <https://aws.amazon.com/tw/ebs/> (AWS EBS)
[aws-az]: <https://aws.amazon.com/about-aws/global-infrastructure/regions_az/> (Availability Zones)
[aws-sla]: <https://aws.amazon.com/eks/sla/> (Amazon EKS Service Level Agreement)

[External Application Related]: <==================================================>
[argo]: <https://argoproj.github.io/argo-workflows/> (Argo)
[argo-workflow]: <https://argoproj.github.io/argo-workflows/> (Argo Workflow)
[argo-event]: <https://argoproj.github.io/argo-events/> (Argo Events)
[argo-workflow-templates]: <https://argo-workflows.readthedocs.io/en/latest/workflow-templates/> (Argo Workflow Templates)
[argo-access-token]: <https://argo-workflows.readthedocs.io/en/latest/access-token/> (Argo Access Token)
[argo-event-source]: <https://github.com/argoproj/argo-events/blob/master/api/event-source.md> (Event Source)
[argo-sensor]: <https://github.com/argoproj/argo-events/blob/master/api/sensor.md> (Sensor)
[argo-cd]: <https://argo-cd.readthedocs.io/en/stable/> (Argo CD)
[argo-cd-helm]: <https://artifacthub.io/packages/helm/argo/argo-cd> (Argo CD Helm)
[argo-cd-image-updater]: <https://argocd-image-updater.readthedocs.io/en/stable/> (Argo CD Image Updater)
[argo-cd-application]: <https://argo-cd.readthedocs.io/en/stable/operator-manual/declarative-setup/#applications> (Argo CD Application)
[argo-cd-image-updater-helm]: <https://artifacthub.io/packages/helm/argo/argocd-image-updater> (Argo CD Image Updater Helm)
[argo-cd-projects]: <https://argo-cd.readthedocs.io/en/stable/user-guide/projects/> (Argo CD Projects)
[argo-cd-repository]: <https://argo-cd.readthedocs.io/en/stable/user-guide/private-repositories/> (Argo CD Repository)
[longhorn]: <https://longhorn.io/> (Longhorn)
[keycloak]: <https://www.keycloak.org/> (Keycloak)
[mongo-db]: <https://www.mongodb.com/> (MongoDB)
[swagger]: <https://swagger.io/solutions/getting-started-with-oas/> (Swagger)
[sonarqube]: <https://www.sonarsource.com/products/sonarqube/> (SonarQube)
[nextflow]: <https://www.nextflow.io/> (Nextflow)

[Internal Application Related]: <==================================================>
[univar]: <https://github.com/kensung-lab/UniVar> (UniVar)
[univar-frontend]: <https://github.com/kensung-lab/univar-frontend> (UniVar Frontend)
[univar-backend]: <https://github.com/kensung-lab/univar-backend> (UniVar Backend)
[variant-import-tool]: <https://github.com/kensung-lab/variant-import-tool> (Variant Import tool)
[s3-proxy-service]: <https://github.com/kensung-lab/s3-proxy-service> (S3 Proxy Service)

[Internal Application Guide]: <==================================================>

[Internal Application Links]: <==================================================>